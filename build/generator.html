<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Query generator</title>
    <script src="tables.js"></script>
<style>
body{font-family:Arial,sans-serif;font-size:11pt}.rc-prev{color:#ccc}.rc-past{color:#666}.rc-new{font-weight:700}.sql-keyword{color:#620;font-weight:700}.sql-star{color:#f50}.sql-column{color:#a01}.sql-text{color:#250}.sql-number{color:#30f}#page{display:flex;height:100vh}#side{flex-shrink:0;height:100vh;min-width:470px;overflow-y:auto;padding:8px}#result{flex-grow:1;padding:20px;font-family:Consolas,monospace}#query{border:1px solid #333;background-color:#eee;display:inline-block;padding:20px}#query:empty,#query_debug:empty{display:none}#tables{margin-bottom:1em}#version{float:right;font-size:.8em;color:#ac8}.clicky{cursor:pointer}.active-column{font-weight:700}.btn-active{background-color:#ff4}.btn-table{background-color:transparent;color:#111;font-weight:700;padding:2px;border:0;font-size:10.5pt}.btn-table:hover{background-color:#ff7}ul.table-list{list-style:none;padding:5px}.rc-source{font-weight:700}li.separator{margin-top:4px;border-top:1px dashed #ccc;padding-top:2px}
</style>
    <link rel="stylesheet" href="custom.css"/>
</head>
<body>

<div id="version"></div>
<div id="page">
    <div id="side">
        <div id="tables"></div>
        <button id="btn_reset">Reset</button>
        <button id="btn_agg" style="display: none">Aggregate</button>
    </div>
    <div id="result">
        <pre id="query"></pre>
        <div id="query_debug"></div>
    </div>
</div>

<script>
"use strict";var QB;!function(e){e.AggregateButton=class{constructor(e){this.buttonElement=e}hide(){this.buttonElement.style.display="none",this.turnOff()}show(){this.buttonElement.style.display="inline-block"}turnOff(){this.buttonElement.classList.remove("btn-active")}toggle(){return this.buttonElement.classList.contains("btn-active")?(this.buttonElement.classList.remove("btn-active"),!1):(this.buttonElement.classList.add("btn-active"),!0)}initializeOnClickHandler(e){this.buttonElement.addEventListener("click",e)}}}(QB||(QB={})),function(e){e.DocElemHelper=class{constructor(){}static getElementById(e){const t=document.getElementById(e);if(!t)throw new Error(`Failed to retrieve element with ID "${e}"`);return t}static getNextElemSibling(e){const t=e.nextElementSibling;if(!t)throw new Error('Element "'+e+'" unexpectedly had no siblings');return t}static newElemWithClass(e,t){const s=document.createElement(e);return s.className=t,s}static newElemWithText(e,t){const s=document.createElement(e);return s.innerText=t,s}}}(QB||(QB={})),function(e){e.Formatter=class{constructor(e,t,s){this.sqlTypeHandler=e,this.aliasFn=t,this.schema=s}formatTable(e,t=!1,s){const l=this.schema?`${this.schema}.${e}`:e;if(t){const t=s??this.aliasFn(e);if(t)return l+" "+t}return l}formatColumn(e,t,s,l){if(!s)return`<span class="sql-column">${t}</span>`;const n=l??this.aliasFn(e);return`${n||this.formatTable(e)}.<span class="sql-column">${t}</span>`}generateQuery(e){return e?this.produceSql(0,e)+";":""}produceSql(e,t){const s="    ".repeat(e),l="\n"+s,n=!!t.leftJoin;let a=s+'<span class="sql-keyword">SELECT</span> ';if(t.select?.length?(a+=t.select.map((e=>this.formatColumn(e.table,e.column,n,e.manualAlias))).join("\n     , "),t.aggregate&&(a+='\n     , <span class="sql-keyword">COUNT(<span class="sql-number">1</span>) AS <span class="sql-text">total</span></span>')):t.aggregate?a+='<span class="sql-keyword">COUNT(<span class="sql-number">1</span>) AS <span class="sql-text">total</span></span>':a+='<span class="sql-star">*</span>',a+=l+'<span class="sql-keyword">FROM</span> '+this.formatTable(t.table,n),t.leftJoin&&t.leftJoin.forEach((e=>{a+=l+'<span class="sql-keyword">LEFT JOIN</span> '+this.formatTable(e.targetTable,!0,e.targetTableAlias)+l+'  <span class="sql-keyword">ON</span> '+this.formatColumn(e.targetTable,e.targetColumn,!0,e.targetTableAlias)+" = "+this.formatColumn(e.sourceTable,e.sourceColumn,!0,e.sourceTableAlias),e.joinVariantFilter&&(a+=l+'    <span class="sql-keyword">AND</span> '+e.joinVariantFilter.replaceAll("$ALIAS",e.targetTableAlias))})),t.subqueryFilterColumn&&(a+=l+'<span class="sql-keyword">WHERE</span> '+this.formatColumn(t.table,t.subqueryFilterColumn,n)+' <span class="sql-keyword">IN</span> (\n'+this.produceSql(e+1,t.sub)+l+")"),t.where){let e=!!t.subqueryFilterColumn;t.where.forEach((s=>{a+=e?l+'  <span class="sql-keyword">AND</span> ':l+'<span class="sql-keyword">WHERE</span> ',a+=this.formatColumn(t.table,s.column,n),s.filter?"!"===s.filter?a+=' <span class="sql-keyword">IS NOT NULL</span>':"string"==typeof s.filter?a+=" = "+this.sqlTypeHandler.formatValueForWhereClause(s.filter,t.table,s.column):a+=" "+this.sqlTypeHandler.formatFilterForWhereClause(s.filter,t.table,s.column):a+=' <span class="sql-keyword">IS NULL</span>',e=!0}))}return t.aggregate&&t.select?.length&&(a+=l+'<span class="sql-keyword">GROUP BY</span> '+t.select.map((e=>this.formatColumn(e.table,e.column,n))).join("\n       , ")),a}}}(QB||(QB={})),function(e){e.Initializer=class{__construct(){}static init(t,s,l,n,a,r,i){e.TableDefinitions.init(s);const o=new e.SqlTypeHandler(a),u=new e.Formatter(o,l,n),c=new e.QueryState,m=new e.AggregateButton(e.DocElemHelper.getElementById("btn_agg")),h=new e.QueryService(c,u,r,i),d=new e.SelectColumnMenu(h),b=new e.MenuHandler(e.DocElemHelper.getElementById("tables"),m,h,o,d);e.DocElemHelper.getElementById("btn_reset").addEventListener("click",(()=>b.showInitialTables())),m.initializeOnClickHandler((()=>{h.updateQuery((e=>{const t=m.toggle();e.setAggregate(t)}))})),b.showInitialTables(),e.DocElemHelper.getElementById("version").innerText=`v. ${t}`}}}(QB||(QB={})),function(e){class t{constructor(e,t,s,l,n){this.tablesContainer=e,this.aggregateButton=t,this.queryService=s,this.sqlTypeHandler=l,this.selectColumnMenu=n}showInitialTables(){this.aggregateButton.hide(),this.queryService.updateQuery((e=>{e.clearState()})),this.tablesContainer.innerHTML="<h3>Tables</h3>",this.tablesContainer.className="menu-initial";const t=e.DocElemHelper.newElemWithClass("div","table-list tl-initial");for(const s in e.TableDefinitions.getAllTables()){const l=document.createElement("button");l.className="btn-table"+this.getCustomClassSuffix(s),l.innerText=s,l.addEventListener("click",(()=>{const t=e.DocElemHelper.getNextElemSibling(l);"UL"===t.tagName?t.remove():this.showColumnsToFilterInitialTable(s,l)})),l.addEventListener("contextmenu",(e=>{e.preventDefault(),this.queryService.updateQuery((e=>{e.selectTable(s),this.showRelatedColumns(s),this.tablesContainer.append(this.selectColumnMenu.generateColumnsButtonOrList(!0))}))})),t.append(l),t.append(document.createElement("br"))}this.tablesContainer.append(t)}showColumnsToFilterInitialTable(t,s){for(const e of document.querySelectorAll("ul.columns"))e.remove();const l=e.DocElemHelper.newElemWithClass("ul","columns");for(const s in e.TableDefinitions.getColumns(t)){const n=e.DocElemHelper.newElemWithClass("li","clicky"),a=e.TableDefinitions.getStyle(t)[s]??"";n.innerHTML=`<span class="${a}">${s}</span>`,n.addEventListener("click",(()=>this.createColumnFilterElem(t,s,n,!1))),n.addEventListener("contextmenu",(e=>{e.preventDefault(),this.queryService.updateQuery((e=>{e.selectTable(t),e.addColumnSelect(t,s),this.showRelatedColumns(t),this.tablesContainer.append(this.selectColumnMenu.generateColumnsButtonOrList())}))})),l.append(n)}s.after(l)}showFilterColumnsSubQuery(t){for(const e of document.querySelectorAll("ul.columns"))e.remove();const s=e.DocElemHelper.newElemWithText("h3",`Filter subquery (${t})`),l=e.DocElemHelper.newElemWithClass("ul","columns");for(const s in e.TableDefinitions.getColumns(t)){const n=e.DocElemHelper.newElemWithClass("li","clicky");n.innerText=s,n.addEventListener("click",(()=>{this.createColumnFilterElem(t,s,n,!0)})),l.append(n)}this.tablesContainer.append(s),this.tablesContainer.append(l)}createColumnFilterElem(t,s,l,n){for(const e of document.querySelectorAll(".where_input"))e.remove();const a=e.DocElemHelper.newElemWithClass("input","where_input");a.type="text";const r=()=>{let e="";try{e=this.sqlTypeHandler.validateColumnFilterElem(t,s,a.value)}catch(e){return void window.alert(e.message)}this.queryService.updateQuery((l=>{n?l.addFilterToSubQuery(s,e):l.selectTableWithFilter(t,s,e),this.showRelatedColumns(n?l.getCurrentSelectedTable():t),this.tablesContainer.append(this.selectColumnMenu.generateColumnsButtonOrList(!n))}))};a.addEventListener("keydown",(e=>{"Enter"===e.key&&r()})),l.after(a);const i=e.DocElemHelper.newElemWithClass("button","where_input");i.innerText="Go",i.addEventListener("click",(()=>{r()})),a.after(i)}getClassForRelatedColumn(e,t){for(const t of this.queryService.getPastColumns())if(t.table===e)return"rc-past";return"rc-new"}collectRelatedColumns(t){const s=[];return e.TableDefinitions.collectAllReferences(t).forEach((e=>{s.push({...e,reversed:!1})})),e.TableDefinitions.collectReferencesToTable(t).forEach((e=>{s.push({sourceTable:e.targetTable,sourceColumn:e.targetColumn,targetTable:e.sourceTable,targetColumn:e.sourceColumn,joinVariants:e.joinVariants,reversed:!0})})),s}showRelatedColumns(t){const s=this.collectRelatedColumns(t);this.aggregateButton.show(),this.tablesContainer.innerHTML="<h3>Join/subquery table</h3>",this.tablesContainer.className="menu-related";const l=e.DocElemHelper.newElemWithClass("ul","table-list tl-related");s.forEach((s=>{const n=document.createElement("li"),a=e.DocElemHelper.newElemWithText("button","⟕");if(a.title="Left join",a.addEventListener("click",(()=>{const e={sourceTable:t,sourceColumn:s.sourceColumn,targetTable:s.targetTable,targetColumn:s.targetColumn};this.onClickLeftJoinColumn(e)})),n.append(a),this.queryService.showWhereQueryInButton()){const t=e.DocElemHelper.newElemWithText("button","⊆");t.title="keep current table, filter by this table",t.addEventListener("click",(()=>{this.onClickWhereIn(s.sourceColumn,s.targetTable,s.targetColumn)})),n.append(t)}const r=e.DocElemHelper.newElemWithClass("span","clicky"),i=this.getClassForRelatedColumn(s.targetTable,s.targetColumn)+this.getCustomClassSuffix(s.targetTable);r.innerHTML=` <span class="${i}">${s.targetTable}</span> (${s.targetColumn})`,n.append(r),r.addEventListener("click",(()=>{this.onClickReferenceColumn(s.sourceColumn,s.targetTable,s.targetColumn)})),r.addEventListener("contextmenu",(e=>{e.preventDefault(),this.onClickReferenceColumn(s.sourceColumn,s.targetTable,s.targetColumn)})),l.append(n)})),this.tablesContainer.append(l)}showLeftJoinColumns(){const t=this.queryService.collectTopLevelTables();this.aggregateButton.show();const s=[];t.forEach((e=>{s.push(...this.collectRelatedColumns(e))}));const l=[];for(const e of s)l.push(...this.mapTableReference(e,t));this.tablesContainer.innerHTML="<h3>Left join</h3>",this.tablesContainer.className="menu-left-join";const n=e.DocElemHelper.newElemWithClass("ul","table-list tl-left-join");l.forEach((t=>{const s=document.createElement("li"),l=e.DocElemHelper.newElemWithClass("span","clicky"),a="rc-target "+this.getClassForRelatedColumn(t.targetTable,t.targetColumn)+this.getCustomClassSuffix(t.targetTable),r="rc-source"+this.getCustomClassSuffix(t.sourceTable),i=t.sourceTableAlias?` (${t.sourceTableAlias})`:"",o=t.joinVariantName?` (${t.joinVariantName})`:"";l.innerHTML=` <span class="${r}">${t.sourceTable}</span>.${t.sourceColumn} ${i} &rarr; <span class="${a}">${t.targetTable}</span>.${t.targetColumn} ${o}`,s.append(l),l.addEventListener("click",(()=>{this.onClickLeftJoinColumn(t)})),l.addEventListener("contextmenu",(e=>{e.preventDefault(),this.onClickLeftJoinColumn(t)})),n.append(s)})),this.tablesContainer.append(n);const a=this.selectColumnMenu.generateColumnsButtonOrList();this.tablesContainer.append(a)}mapTableReference(e,s){const l=t.isNotNullAndNotEmpty(e.joinVariants)&&e.reversed,n=this.queryService.getLeftJoins();if(!l){if(s.has(e.sourceTable)&&s.has(e.targetTable))return[];const l=new Set,a=new Set;for(const t of n)t.sourceTable===e.sourceTable&&l.add(t.sourceTableAlias),t.targetTable===e.sourceTable&&l.add(t.targetTableAlias),t.sourceTable===e.targetTable&&a.add(t.sourceTableAlias),t.targetTable===e.targetTable&&a.add(t.targetTableAlias);t.addUndefinedIfEmpty(l),t.addUndefinedIfEmpty(a);const r=[];for(const t of l)for(const s of a)r.push({sourceTable:e.sourceTable,sourceColumn:e.sourceColumn,sourceTableAlias:t,targetTable:e.targetTable,targetColumn:e.targetColumn,targetTableAlias:s});return r}const a=new Set;if(n.filter((e=>!e.joinVariantName)).forEach((e=>{a.add(e.sourceTable),a.add(e.targetTable)})),a.has(e.sourceTable)&&a.has(e.targetTable))return[];const r=new Set;for(const t of n)t.sourceTable===e.sourceTable&&r.add(t.sourceTableAlias),t.targetTable===e.sourceTable&&r.add(t.targetTableAlias);t.addUndefinedIfEmpty(r);const i=[];return e.joinVariants.forEach((t=>{if(!n.some((s=>s.sourceTable===e.sourceTable&&s.targetTable===e.targetTable&&s.joinVariantName===t.name)))for(const s of r)i.push({sourceTable:e.sourceTable,sourceColumn:e.sourceColumn,sourceTableAlias:s,targetTable:e.targetTable,targetColumn:e.targetColumn,targetTableAlias:t.alias,joinVariantName:t.name,joinVariantFilter:t.filter})})),i}static isNotNullAndNotEmpty(e){return!!e&&e.length>0}static addUndefinedIfEmpty(e){0===e.size&&e.add(void 0)}onClickLeftJoinColumn(e){this.queryService.updateQuery((t=>{t.addLeftJoin(e),this.showLeftJoinColumns()}))}onClickReferenceColumn(e,t,s){this.queryService.updateQuery((l=>{l.addSuperQuery(e,t,s),this.aggregateButton.turnOff(),this.showRelatedColumns(t),this.tablesContainer.append(this.selectColumnMenu.generateColumnsButtonOrList(!0))}))}onClickWhereIn(e,t,s){this.queryService.updateQuery((l=>{l.addSubQuery(e,t,s),this.showRelatedColumns(l.getCurrentSelectedTable()),this.showFilterColumnsSubQuery(t),this.tablesContainer.append(this.selectColumnMenu.generateColumnsButtonOrList())}))}getCustomClassSuffix(t){const s=e.TableDefinitions.getStyle(t);return s.table?" "+s.table:""}}e.MenuHandler=t}(QB||(QB={})),function(e){e.QueryService=class{constructor(e,t,s,l){this.query=e,this.formatter=t,this.configDebugEnabled=s,this.configShowWhereInButton=l}updateQuery(e){e(this.query),this.updateQueryOnPage()}collectTopLevelTables(){return this.query.collectTopLevelTables()}collectSelectedTableAliasPairs(){const e=new Map;e.set(this.query.getCurrentSelectedTable(),new Set([void 0])),this.getLeftJoins().forEach((t=>{const s=e.get(t.sourceTable);void 0===s?e.set(t.sourceTable,new Set([t.sourceTableAlias])):s.add(t.sourceTableAlias);const l=e.get(t.targetTable);void 0===l?e.set(t.targetTable,new Set([t.targetTableAlias])):l.add(t.targetTableAlias)}));const t=[];for(let[s,l]of e)l.forEach((e=>{t.push({table:s,manualAlias:e})}));return t}getLeftJoins(){return this.query.getQuery()?.leftJoin??[]}showWhereQueryInButton(){return this.configShowWhereInButton&&!this.query.hasWhereInClause()}getPastColumns(){return this.query.getPastColumns()}hasColumnSelect(e,t,s){return this.query.hasColumnSelect(e,t,s)}hasAnyColumnSelect(){return this.query.hasAnyColumnSelect()}updateQueryOnPage(){e.DocElemHelper.getElementById("query").innerHTML=this.formatter.generateQuery(this.query.getQuery()),this.configDebugEnabled&&(e.DocElemHelper.getElementById("query_debug").innerHTML=JSON.stringify(this.query.getQuery()).replaceAll("{","{ "))}}}(QB||(QB={})),function(e){e.QueryState=class{constructor(){this.pastColumns=new Set}clearState(){this.query=void 0,this.pastColumns=new Set}selectTable(e){this.query={table:e},this.pastColumns.add({table:e,column:""})}selectTableWithFilter(e,t,s){this.query={table:e,where:[{column:t,filter:s}]},this.pastColumns.add({table:e,column:t})}addFilterToSubQuery(e,t){if(!this.query?.sub)throw new Error("Expect subquery to be set!");this.query.sub.where=this.query.sub.where??[],this.query.sub.where.push({column:e,filter:t}),this.pastColumns.add({table:this.query.sub.table,column:e})}addSuperQuery(e,t,s){if(!this.query)throw new Error("Query must be defined");this.query.select=[{table:this.query.table,column:e}],this.query.aggregate=!1,this.query={table:t,subqueryFilterColumn:s,sub:this.query},this.pastColumns.add({table:this.query.sub.table,column:e})}addSubQuery(e,t,s){if(!this.query)throw new Error("Query must be defined");this.query.subqueryFilterColumn=e,this.query.sub={select:[{column:s,table:t}],table:t},this.pastColumns.add({table:t,column:s})}addLeftJoin(e){this.query.leftJoin||(this.query.leftJoin=[]),this.query.leftJoin.push(e)}setAggregate(e){this.query.aggregate=e}clearColumnSelects(){this.query.select=[]}addColumnSelect(e,t,s){this.query.select||(this.query.select=[]),this.query.select.push({table:e,column:t,manualAlias:s})}getCurrentSelectedTable(){return this.query.table}collectTopLevelTables(){const e=new Set;if(e.add(this.query.table),this.query.leftJoin)for(const t of this.query.leftJoin)e.add(t.sourceTable),e.add(t.targetTable);return e}hasWhereInClause(){return!!this.query?.subqueryFilterColumn}hasColumnSelect(e,t,s){return!(!this.query||!this.query.select)&&this.query.select.some((l=>l.table===e&&l.column===t&&l.manualAlias===s))}hasAnyColumnSelect(){return!!this.query?.select&&this.query.select.length>0}getQuery(){return this.query||null}getPastColumns(){return this.pastColumns}}}(QB||(QB={})),function(e){e.SelectColumnMenu=class{constructor(e){this.queryService=e,this.isExpanded=!1}generateColumnsButtonOrList(t){if(!this.isExpanded||t){this.isExpanded=!1;const t=e.DocElemHelper.newElemWithText("button","Select columns");return t.addEventListener("click",(()=>{this.isExpanded=!0,t.parentElement.append(this.createListElementWithSelectableColumns()),t.remove()})),t}return this.createListElementWithSelectableColumns()}createListElementWithSelectableColumns(){const t=this.queryService.collectSelectedTableAliasPairs(),s=[];t.forEach((t=>{for(const l in e.TableDefinitions.getColumns(t.table))s.push({table:t.table,column:l,manualAlias:t.manualAlias,active:this.queryService.hasColumnSelect(t.table,l,t.manualAlias)})}));const l=document.createElement("div"),n=e.DocElemHelper.newElemWithClass("h3","clicky");n.innerText="Select columns",n.addEventListener("click",(()=>{this.queryService.hasAnyColumnSelect()||(this.isExpanded=!1,l.parentElement.append(this.generateColumnsButtonOrList()),l.remove())}));const a=t.length>1,r=e.DocElemHelper.newElemWithClass("ul","column-select");let i="";return s.forEach((t=>{const s=e.DocElemHelper.newElemWithClass("li","clicky");i&&i!==t.table&&s.classList.add("separator");const l=e.TableDefinitions.getStyle(t.table);let o="";if(a){o=`<span class="tbl ${l.table??""}">${t.table}</span>.`}const u=l[t.column]??"";s.innerHTML=o+`<span class="col ${u}">${t.column}</span>`+(t.manualAlias?` (${t.manualAlias})`:""),s.dataset.table=t.table,s.dataset.column=t.column,t.manualAlias&&(s.dataset.manualAlias=t.manualAlias),t.active&&s.classList.add("active-column"),s.addEventListener("click",(()=>this.toggleColumnActive(s,n))),r.append(s),i=t.table})),l.append(n),l.append(r),l}toggleColumnActive(e,t){e.classList.contains("active-column")?e.classList.remove("active-column"):e.classList.add("active-column"),this.queryService.updateQuery((s=>{s.clearColumnSelects();for(const t of e.parentElement.children)if(t instanceof HTMLElement&&t.classList.contains("active-column")){const e=t.dataset.table,l=t.dataset.column,n=t.dataset.manualAlias;s.addColumnSelect(e,l,n)}this.queryService.hasAnyColumnSelect()?t.classList.remove("clicky"):t.classList.add("clicky")}))}}}(QB||(QB={})),function(e){e.SqlTypeHandler=class{constructor(e){this.dbEngine=e}formatValueForWhereClause(t,s,l){switch(e.TableDefinitions.getColumnType(s,l)){case"int":case"tinyint":case"decimal":case"number":return`<span class="sql-number">${t}</span>`;default:return'<span class="sql-text">\''+this.escapeValueForSqlAndHtml(t)+"'</span>"}}formatFilterForWhereClause(e,t,s){if("datetime_interval"===e.type)return e.value.replaceAll("INTERVAL",'<span class="sql-keyword">INTERVAL</span>');throw new Error("Unsupported filter of type: "+e.type)}validateColumnFilterElem(t,s,l){if(""===l||"!"===l)return l;let n=e.TableDefinitions.getColumnType(t,s);switch(n.startsWith("timestamp")&&(n="timestamp"),n){case"int":case"tinyint":case"decimal":case"number":if(l&&"!"!==l&&Number.isNaN(Number(l)))throw new Error("Invalid number");return l;case"timestamp":case"datetime":return this.handleDateTimeValue(l);case"varchar":case"varchar2":case"blob":case"clob":return l;default:return console.log(`Unhandled validation for ${n}`),l}}handleDateTimeValue(e){const t=e.match(/([+\-])\s?(\d+)\s?([smhdy])/);if(t){const e="+"===t[1]?"<":">",s=t[2],l=this.convertDateTimeUnit(t[3]);return{type:"datetime_interval",value:e+" "+("MySQL"===this.dbEngine?`NOW() - INTERVAL ${s} ${l}`:`sysdate - INTERVAL '${s}' ${l}`)}}throw Error("Invalid timestamp expression")}convertDateTimeUnit(e){switch(e){case"s":return"SECOND";case"m":return"MINUTE";case"h":return"HOUR";case"d":return"DAY";case"y":return"YEAR";default:throw new Error(`Unhandled unit: ${e}`)}}escapeValueForSqlAndHtml(e){return e.replaceAll("'","''").replaceAll("&","&amp;").replaceAll("<","&lt;")}}}(QB||(QB={})),function(e){e.TableDefinitions=class{constructor(){}static init(e){this.tables=e}static getColumnType(e,t){return this.tables[e].columns[t]}static getColumns(e){return this.tables[e].columns}static collectAllReferences(e){const t=[];return Object.entries(this.tables[e].references).forEach((([s,l])=>{l.forEach((l=>{t.push({sourceTable:e,sourceColumn:s,targetTable:l.table,targetColumn:l.column,joinVariants:l.joinVariants})}))})),t}static collectReferencesToTable(e){const t=[];for(const s in this.tables)s!==e&&Object.entries(this.tables[s].references).forEach((([l,n])=>{n.forEach((n=>{n.table===e&&t.push({sourceTable:s,sourceColumn:l,targetTable:e,targetColumn:n.column,joinVariants:n.joinVariants})}))}));return t}static getAllTables(){return this.tables}static getStyle(e){return this.tables[e].style??{}}}}(QB||(QB={}));
</script>
<script>

// -------------
// Configuration
// -------------

const __dbEngine = 'MySQL';
const __schema = 'nightbot_quiz';
const __aliasFn = function (tableName) {
    return __tables[tableName].alias;
};

// Show internal query object as JSON
const __debug = false;

// Show the '⊆' button that *adds* a subquery to the current table. If you feel that there are too many buttons,
// you can hide this to simplify the UI. Clicking on a table name will take the current query and use it as subquery,
// which is possible in more situations than this button.
const __showWhereInButton = true;

// -------------
// End config
// -------------

const __version = '20250205';
QB.Initializer.init(__version, __tables, __aliasFn, __schema, __dbEngine, __debug, __showWhereInButton);

</script>
</body>
</html>